<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>reado: 宝石中心</title>
  <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      background: radial-gradient(circle at top right, #1d3357 0%, transparent 40%), #0a1019;
      color: #e6eef9;
      font-family: "Noto Sans SC", sans-serif;
    }
  </style>
</head>
<body class="p-6 md:p-10">
<script src="/shared/book-catalog.js?v=1771766498147"></script>
<script type="module" src="/shared/shell.js?v=1771766498147"></script>
<reado-app-shell data-page="other"></reado-app-shell>
  <main class="max-w-3xl mx-auto space-y-6">
    <header class="rounded-2xl border border-cyan-300/20 bg-slate-900/65 p-6">
      <h1 class="text-3xl md:text-4xl font-black text-white">宝石中心</h1>
      <p class="mt-2 text-slate-300">每日可免费领取一次 <strong class="text-cyan-300">100 宝石</strong>。</p>
      <div class="mt-5 inline-flex items-center gap-2 px-4 py-2 rounded-full border border-cyan-300/35 bg-cyan-400/10">
        <span class="material-icons text-cyan-300 text-base">diamond</span>
        <span class="text-cyan-200 font-bold">当前宝石：<span id="reado-gem-total">--</span></span>
      </div>
    </header>
    <section class="rounded-2xl border border-white/10 bg-slate-900/55 p-6">
      <h2 class="text-xl font-black text-white">每日补给</h2>
      <p id="reado-gem-tip" class="mt-2 text-sm text-slate-300">正在读取领取状态...</p>
      <button id="reado-gem-claim-btn" class="mt-4 px-5 py-2 rounded-lg font-bold text-sm transition-all bg-blue-600 text-white hover:brightness-110">免费领取 100 宝石</button>
    </section>
    <section class="rounded-2xl border border-white/10 bg-slate-900/40 p-6">
      <h3 class="text-lg font-black text-white">快速入口</h3>
      <div class="mt-3 flex flex-wrap gap-2">
        <a href="/pages/gamified-learning-hub-dashboard-3.html" class="px-3 py-2 rounded-lg border border-white/15 text-slate-200 text-sm font-bold">交易中心</a>
        <a href="/pages/simulator-library-level-selection-2.html" class="px-3 py-2 rounded-lg border border-white/15 text-slate-200 text-sm font-bold">任务中心</a>
        <a href="/pages/gamified-learning-hub-dashboard-2.html" class="px-3 py-2 rounded-lg border border-white/15 text-slate-200 text-sm font-bold">个人资料</a>
      </div>
    </section>
  </main>
  <script>
    (() => {
      const claimKey = "reado_daily_gem_claim_v1";
      const totalEl = document.getElementById("reado-gem-total");
      const tipEl = document.getElementById("reado-gem-tip");
      const btnEl = document.getElementById("reado-gem-claim-btn");
      if (!totalEl || !tipEl || !btnEl) return;

      const dayKey = () => {
        const now = new Date();
        const y = now.getFullYear();
        const m = String(now.getMonth() + 1).padStart(2, "0");
        const d = String(now.getDate()).padStart(2, "0");
        return y + "-" + m + "-" + d;
      };

      const render = () => {
        const user = window.ReadoUser?.getState?.();
        if (user) totalEl.textContent = new Intl.NumberFormat("zh-CN").format(user.gems || 0);
        const today = dayKey();
        const claimed = localStorage.getItem(claimKey) === today;
        tipEl.textContent = claimed ? "今日免费宝石已领取，明天再来。" : "今日尚未领取，点击下方按钮即可获得 100 宝石。";
        btnEl.disabled = claimed;
        btnEl.className = claimed
          ? "mt-4 px-5 py-2 rounded-lg font-bold text-sm transition-all bg-white/10 text-slate-500 cursor-not-allowed"
          : "mt-4 px-5 py-2 rounded-lg font-bold text-sm transition-all bg-blue-600 text-white hover:brightness-110";
      };

      const waitUser = () => {
        if (window.ReadoUser?.getState && window.ReadoUser?.grantRewards) {
          render();
          return;
        }
        setTimeout(waitUser, 60);
      };
      waitUser();

      btnEl.addEventListener("click", () => {
        const today = dayKey();
        if (localStorage.getItem(claimKey) === today) {
          render();
          return;
        }
        window.ReadoUser?.grantRewards?.({ gems: 100, xp: 0, reason: "daily-free-gems" });
        localStorage.setItem(claimKey, today);
        render();
      });

      window.addEventListener("reado:user-updated", render);
    })();
  </script>
</body>
</html>